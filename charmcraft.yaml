# Copyright 2024 Canonical Ltd.
# See LICENSE file for licensing details.

name: filesystem-client

type: charm

title: Filesystem Client

summary: Mount filesystems on machine charms.

description: |
  Mount filesystems on machine charms.

  Enables access to exported filesystems.

base: ubuntu@24.04
platforms:
  amd64:

parts:
  charm:
    build-packages:
      - just
    build-snaps:
      - astral-uv
    charm-requirements: ["requirements.txt"]
    charm-binary-python-packages:
      - rpds_py ~= 0.22.3
    override-build: |
      just requirements
      craftctl default

subordinate: true

requires:
  filesystem:
    interface: filesystem_info
  juju-info:
    interface: juju-info
    scope: container

config:
  options:
    mounts:
      default: "{}"
      type: string
      description: |
        Information to mount filesystems on the machine. This is specified as a JSON object string.
        Example usage:
          ```bash
          $ juju config filesystem-client \
              mounts=<<EOF
                {
                  "cephfs": {
                    "mountpoint": "/scratch",
                    "noexec": true
                  },
                  "nfs": {
                    "mountpoint": "/data",
                    "nosuid": true,
                    "nodev": true,
                    "read-only": true,
                  }
                }
              EOF
          ```